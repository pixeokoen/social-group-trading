import{d as P,r as x,k as S,l as N,a as l,b as e,m as V,f as m,i as h,g as d,t as s,F as b,e as k,q as E,s as C,o}from"./index-CK_gKUp_.js";const F={class:"py-6"},j={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},B={class:"md:flex md:items-center md:justify-between"},T={class:"mt-4 flex space-x-3 md:mt-0"},A=["disabled"],I={key:0,class:"text-sm text-gray-500 self-center"},O={class:"mt-8"},D={class:"sm:hidden"},G={class:"bg-white shadow overflow-hidden sm:rounded-md"},H={class:"divide-y divide-gray-200"},U={class:"flex items-center justify-between"},q={class:"flex items-center space-x-3"},Q={class:"font-medium text-gray-900"},J=["onClick"],K={class:"mt-2 text-sm text-gray-500"},R={class:"mt-2 flex items-center justify-between"},W={class:"mt-1"},X={class:"hidden sm:block"},Y={class:"flex flex-col"},Z={class:"-my-2 overflow-x-auto sm:-mx-6 lg:-mx-8"},ee={class:"py-2 align-middle inline-block min-w-full sm:px-6 lg:px-8"},te={class:"shadow overflow-hidden border-b border-gray-200 sm:rounded-lg"},se={class:"min-w-full divide-y divide-gray-200"},ne={class:"bg-white divide-y divide-gray-200"},ae={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},re={class:"px-6 py-4 whitespace-nowrap text-sm"},le={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},oe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},de={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ie={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ce={class:"px-6 py-4 whitespace-nowrap text-sm"},xe={class:"px-6 py-4 whitespace-nowrap text-sm"},ue={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},me=["onClick"],pe={key:0,class:"text-center py-12"},ge=P({__name:"PositionsView",setup(ye){const u=x([]),i=x(!1),p=x(null),y=x(!1),_=x(null);let g=null;const v=n=>n===Math.floor(n)?n.toString():n.toFixed(4),r=n=>n.toFixed(2),z=n=>new Intl.DateTimeFormat("en-US",{hour:"numeric",minute:"2-digit",second:"2-digit"}).format(n),c=async()=>{try{const n=await C.get("/api/positions");u.value=n.data}catch(n){console.error("Error fetching positions:",n)}},f=async()=>{i.value=!0;try{const n=await C.get("/api/positions/sync");console.log("Sync result:",n.data),p.value=new Date,await c(),n.data.positions_count>0&&console.log(`Synced ${n.data.positions_count} positions`)}catch(n){console.error("Error syncing positions:",n)}finally{i.value=!1}},w=n=>{_.value={id:0,symbol:n.symbol,action:"SELL",quantity:n.quantity,source:"close_position",position_data:n},y.value=!0},M=()=>{y.value=!1,_.value=null},$=async n=>{alert(`Position closed successfully! Order ID: ${n.broker_order_id}`),await c()};return S(()=>{c(),g=setInterval(()=>{f()},3e4),f(),window.addEventListener("account-switched",c)}),N(()=>{g&&clearInterval(g),window.removeEventListener("account-switched",c)}),(n,a)=>(o(),l("div",F,[e("div",j,[e("div",B,[a[1]||(a[1]=e("h1",{class:"text-2xl font-semibold text-gray-900"},"Positions",-1)),e("div",T,[e("button",{onClick:f,disabled:i.value,class:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50"},[(o(),l("svg",{class:d(["mr-2 h-4 w-4",i.value?"animate-spin":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},a[0]||(a[0]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)]),2)),h(" "+s(i.value?"Syncing...":"Sync Positions"),1)],8,A),p.value?(o(),l("span",I," Last sync: "+s(z(p.value)),1)):m("",!0)])]),e("div",O,[e("div",D,[e("div",G,[e("ul",H,[(o(!0),l(b,null,k(u.value,t=>(o(),l("li",{key:t.symbol,class:"px-4 py-4"},[e("div",U,[e("div",q,[e("span",Q,s(t.symbol),1),e("span",{class:d([t.side==="LONG"?"text-green-600":"text-red-600","text-sm font-medium"])},s(t.side),3)]),t.side==="LONG"?(o(),l("button",{key:0,onClick:L=>w(t),class:"inline-flex items-center px-3 py-1 border border-transparent text-sm rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"},a[2]||(a[2]=[e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16 11V7a4 4 0 00-8 0v4M5 11h14l-1.68 9.39A2 2 0 0115.34 22H8.66a2 2 0 01-1.98-1.61L5 11z"})],-1),h(" Sell ")]),8,J)):m("",!0)]),e("div",K,[e("div",null,s(v(t.quantity))+" @ $"+s(r(t.avg_entry_price)),1),e("div",null,"Current: $"+s(r(t.current_price)),1),e("div",null,"Value: $"+s(r(t.market_value)),1)]),e("div",R,[e("div",null,[e("div",null,[e("span",{class:d([t.unrealized_pnl>=0?"text-green-600":"text-red-600","text-sm font-medium"])},s(t.unrealized_pnl>=0?"+":"")+"$"+s(r(Math.abs(t.unrealized_pnl)))+" ("+s(t.unrealized_pnl_pct>=0?"+":"")+s(t.unrealized_pnl_pct.toFixed(2))+"%) ",3),a[3]||(a[3]=e("span",{class:"text-xs text-gray-400 ml-1"},"Total",-1))]),e("div",W,[e("span",{class:d([t.today_pnl>=0?"text-green-600":"text-red-600","text-sm"])},s(t.today_pnl>=0?"+":"")+"$"+s(r(Math.abs(t.today_pnl))),3),a[4]||(a[4]=e("span",{class:"text-xs text-gray-400 ml-1"},"Today",-1))])])])]))),128))])])]),e("div",X,[e("div",Y,[e("div",Z,[e("div",ee,[e("div",te,[e("table",se,[a[6]||(a[6]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Symbol "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Side "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Quantity "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Avg Entry "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Current Price "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Market Value "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Unrealized P&L "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Today's P&L "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),e("tbody",ne,[(o(!0),l(b,null,k(u.value,t=>(o(),l("tr",{key:t.symbol},[e("td",ae,s(t.symbol),1),e("td",re,[e("span",{class:d([t.side==="LONG"?"text-green-600":"text-red-600","font-medium"])},s(t.side),3)]),e("td",le,s(v(t.quantity)),1),e("td",oe," $"+s(r(t.avg_entry_price)),1),e("td",de," $"+s(r(t.current_price)),1),e("td",ie," $"+s(r(t.market_value)),1),e("td",ce,[e("div",null,[e("span",{class:d([t.unrealized_pnl>=0?"text-green-600":"text-red-600","font-medium"])},s(t.unrealized_pnl>=0?"+":"")+"$"+s(r(Math.abs(t.unrealized_pnl))),3),e("span",{class:d([t.unrealized_pnl_pct>=0?"text-green-600":"text-red-600","text-xs ml-1"])}," ("+s(t.unrealized_pnl_pct>=0?"+":"")+s(t.unrealized_pnl_pct.toFixed(2))+"%) ",3)])]),e("td",xe,[e("div",null,[e("span",{class:d([t.today_pnl>=0?"text-green-600":"text-red-600","font-medium"])},s(t.today_pnl>=0?"+":"")+"$"+s(r(Math.abs(t.today_pnl))),3),e("span",{class:d([t.today_pnl_pct>=0?"text-green-600":"text-red-600","text-xs ml-1"])}," ("+s(t.today_pnl_pct>=0?"+":"")+s(t.today_pnl_pct.toFixed(2))+"%) ",3)])]),e("td",ue,[t.side==="LONG"?(o(),l("button",{key:0,onClick:L=>w(t),class:"inline-flex items-center px-3 py-1 border border-transparent text-sm rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"},a[5]||(a[5]=[e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16 11V7a4 4 0 00-8 0v4M5 11h14l-1.68 9.39A2 2 0 0115.34 22H8.66a2 2 0 01-1.98-1.61L5 11z"})],-1),h(" Sell ")]),8,me)):m("",!0)])]))),128))])]),u.value.length===0?(o(),l("div",pe,a[7]||(a[7]=[e("p",{class:"text-gray-500"},"No open positions",-1)]))):m("",!0)])])])])])])]),V(E,{signal:_.value,"is-open":y.value,onClose:M,onExecuted:$},null,8,["signal","is-open"])]))}});export{ge as default};
