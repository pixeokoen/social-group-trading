import{d as U,r as u,c as S,k as P,l as I,a as n,b as s,f as c,t as a,F as b,e as y,j as D,i as j,s as M,n as w,g as p,o,_ as A}from"./index-CK_gKUp_.js";const E={class:"script-manager-view"},L={key:0,class:"overview-cards"},N={class:"status-card"},T={class:"card-content"},V={class:"status-card running"},O={class:"card-content"},B={key:0,class:"status-card error"},z={class:"card-content"},H={class:"status-card api"},q={class:"card-content"},G={key:1,class:"api-usage-section"},J={class:"api-stats"},K={class:"api-stat"},Q={class:"value"},W={class:"api-stat"},X={class:"value"},Y={class:"api-stat"},Z={class:"value"},$={class:"api-by-process"},ss={class:"api-process-list"},ts={class:"process-name"},es={class:"usage-bar"},as={class:"usage-stats"},ls={class:"percentage"},ns={key:2,class:"processes-section"},os={class:"processes-table"},rs={class:"col-name"},is={class:"process-info"},cs={class:"process-name"},ds={class:"col-status"},us={class:"col-runs"},_s={class:"runs-info"},vs={class:"total"},ms={class:"breakdown"},ps={class:"success"},hs={class:"error"},gs={class:"col-success"},fs={class:"success-rate"},bs={class:"percentage"},ys={class:"col-duration"},ks={class:"col-api"},xs={class:"col-last"},Ss={key:0},ws={key:1,class:"no-data"},Rs={class:"col-next"},Cs={key:0},Fs={key:1,class:"no-data"},Us={key:3,class:"errors-section"},Ps={class:"error-list"},Is={class:"error-header"},Ds={class:"process-name"},js={class:"error-time"},Ms={class:"error-message"},As={key:4,class:"resources-section"},Es={class:"resource-stats"},Ls={class:"resource-item"},Ns={class:"value"},Ts={class:"resource-item"},Vs={class:"value"},Os={key:5,class:"loading"},Bs={key:6,class:"error-state"},zs={key:7,class:"controls"},Hs=["disabled"],qs={key:0},Gs={key:1},Js={key:0,class:"last-updated"},Ks=U({__name:"ScriptManagerView",setup(Qs){const l=u(null),_=u(!0),v=u(!1),d=u(null),h=u(null);let g=null;const R=S(()=>l.value?Object.values(l.value.processes).some(r=>r.status==="error"&&r.metrics.last_error_message):!1),C=S(()=>l.value?Object.fromEntries(Object.entries(l.value.processes).filter(([r,t])=>t.status==="error"&&t.metrics.last_error_message)):{}),k=r=>{if(!l.value)return 0;const e=Object.values(l.value.processes).map(i=>i.resource_usage[r]).filter(i=>i!=null);return e.length>0?e.reduce((i,F)=>i+F,0)/e.length:0},f=r=>{const t=new Date(r);return new Intl.DateTimeFormat("en-US",{hour:"numeric",minute:"2-digit",second:"2-digit"}).format(t)},x=r=>{const t=new Date(r);return new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"}).format(t)},m=async()=>{l.value?v.value=!0:_.value=!0,d.value=null;try{const r=await M.get("/api/script-manager/status");l.value=r.data,h.value=new Date}catch(r){console.error("Error fetching script manager status:",r),d.value="Failed to fetch script manager status"}finally{_.value=!1,v.value=!1}};return P(()=>{m(),g=setInterval(m,1e4)}),I(()=>{g&&clearInterval(g)}),(r,t)=>(o(),n("div",E,[t[23]||(t[23]=s("div",{class:"header"},[s("h1",null,"üéØ Script Manager"),s("p",{class:"description"}," Centralized monitoring and control for all automated processes ")],-1)),l.value?(o(),n("div",L,[s("div",N,[t[1]||(t[1]=s("div",{class:"card-icon"},"üìä",-1)),s("div",T,[s("h3",null,a(l.value.total_processes),1),t[0]||(t[0]=s("p",null,"Total Processes",-1))])]),s("div",V,[t[3]||(t[3]=s("div",{class:"card-icon"},"üü¢",-1)),s("div",O,[s("h3",null,a(l.value.running_processes),1),t[2]||(t[2]=s("p",null,"Running",-1))])]),l.value.error_processes>0?(o(),n("div",B,[t[5]||(t[5]=s("div",{class:"card-icon"},"üî¥",-1)),s("div",z,[s("h3",null,a(l.value.error_processes),1),t[4]||(t[4]=s("p",null,"Errors",-1))])])):c("",!0),s("div",H,[t[7]||(t[7]=s("div",{class:"card-icon"},"üåê",-1)),s("div",q,[s("h3",null,a(l.value.api_usage.total_calls_last_minute),1),t[6]||(t[6]=s("p",null,"API Calls/min",-1))])])])):c("",!0),l.value?(o(),n("div",G,[t[12]||(t[12]=s("h2",null,"API Usage Summary",-1)),s("div",J,[s("div",K,[t[8]||(t[8]=s("span",{class:"label"},"Current Rate:",-1)),s("span",Q,a(l.value.api_usage.total_calls_last_minute)+" calls/minute",1)]),s("div",W,[t[9]||(t[9]=s("span",{class:"label"},"Projected Hourly:",-1)),s("span",X,"~"+a(l.value.api_usage.estimated_calls_per_hour)+" calls/hour",1)]),s("div",Y,[t[10]||(t[10]=s("span",{class:"label"},"Last Updated:",-1)),s("span",Z,a(x(l.value.api_usage.timestamp)),1)])]),s("div",$,[t[11]||(t[11]=s("h3",null,"Usage by Process",-1)),s("div",ss,[(o(!0),n(b,null,y(l.value.api_usage.usage_by_process,(e,i)=>(o(),n("div",{key:i,class:"api-process-item"},[s("div",ts,a(e.process_name),1),s("div",es,[s("div",{class:p(["usage-fill",{"high-usage":e.usage_percent>80}]),style:w({width:Math.min(e.usage_percent,100)+"%"})},null,6)]),s("div",as,[s("span",null,a(e.calls_last_minute)+"/"+a(e.limit_per_minute),1),s("span",ls,"("+a(e.usage_percent.toFixed(1))+"%)",1)])]))),128))])])])):c("",!0),l.value?(o(),n("div",ns,[t[14]||(t[14]=s("h2",null,"Process Status",-1)),s("div",os,[t[13]||(t[13]=D('<div class="table-header" data-v-096a31fb><div class="col-name" data-v-096a31fb>Process</div><div class="col-status" data-v-096a31fb>Status</div><div class="col-runs" data-v-096a31fb>Runs</div><div class="col-success" data-v-096a31fb>Success Rate</div><div class="col-duration" data-v-096a31fb>Avg Duration</div><div class="col-api" data-v-096a31fb>API Calls</div><div class="col-last" data-v-096a31fb>Last Run</div><div class="col-next" data-v-096a31fb>Next Run</div></div>',1)),(o(!0),n(b,null,y(l.value.processes,(e,i)=>(o(),n("div",{key:i,class:p(["table-row",{"status-running":e.status==="running","status-error":e.status==="error","status-disabled":e.status==="disabled"}])},[s("div",rs,[s("div",is,[s("span",{class:p(["status-indicator",e.status])},null,2),s("span",cs,a(e.process_name),1)])]),s("div",ds,[s("span",{class:p(["status-badge",e.status])},a(e.status.charAt(0).toUpperCase()+e.status.slice(1)),3)]),s("div",us,[s("div",_s,[s("span",vs,a(e.metrics.total_runs),1),s("div",ms,[s("span",ps,"‚úÖ "+a(e.metrics.success_count),1),s("span",hs,"‚ùå "+a(e.metrics.error_count),1)])])]),s("div",gs,[s("div",fs,[s("span",bs,a(e.metrics.total_runs>0?(e.metrics.success_count/e.metrics.total_runs*100).toFixed(1):"0.0")+"% ",1),s("div",{class:"success-bar",style:w({width:e.metrics.total_runs>0?e.metrics.success_count/e.metrics.total_runs*100+"%":"0%"})},null,4)])]),s("div",ys,a(e.metrics.avg_duration.toFixed(2))+"s ",1),s("div",ks,a(e.metrics.api_calls_last_minute),1),s("div",xs,[e.metrics.last_run?(o(),n("span",Ss,a(f(e.metrics.last_run)),1)):(o(),n("span",ws,"Never"))]),s("div",Rs,[e.next_run&&e.status==="running"?(o(),n("span",Cs,a(f(e.next_run)),1)):(o(),n("span",Fs,"-"))])],2))),128))])])):c("",!0),R.value?(o(),n("div",Us,[t[15]||(t[15]=s("h2",null,"‚ö†Ô∏è Recent Errors",-1)),s("div",Ps,[(o(!0),n(b,null,y(C.value,(e,i)=>(o(),n("div",{key:i,class:"error-item"},[s("div",Is,[s("span",Ds,a(e.process_name),1),s("span",js,a(x(e.metrics.last_error)),1)]),s("div",Ms,a(e.metrics.last_error_message),1)]))),128))])])):c("",!0),l.value&&Object.keys(l.value.processes).length>0?(o(),n("div",As,[t[18]||(t[18]=s("h2",null,"üíª System Resources",-1)),s("div",Es,[s("div",Ls,[t[16]||(t[16]=s("span",{class:"label"},"CPU Usage:",-1)),s("span",Ns,a(k("cpu_percent").toFixed(1))+"%",1)]),s("div",Ts,[t[17]||(t[17]=s("span",{class:"label"},"Memory Usage:",-1)),s("span",Vs,a(k("memory_mb").toFixed(1))+" MB",1)])])])):c("",!0),_.value?(o(),n("div",Os,t[19]||(t[19]=[s("div",{class:"spinner"},null,-1),s("p",null,"Loading script manager status...",-1)]))):c("",!0),d.value?(o(),n("div",Bs,[t[20]||(t[20]=s("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),t[21]||(t[21]=s("h3",null,"Failed to Load Status",-1)),s("p",null,a(d.value),1),s("button",{onClick:m,class:"retry-btn"},"Retry")])):c("",!0),!_.value&&!d.value?(o(),n("div",zs,[s("button",{onClick:m,class:"refresh-btn",disabled:v.value},[v.value?(o(),n("span",qs,"‚è≥")):(o(),n("span",Gs,"üîÑ")),t[22]||(t[22]=j(" Refresh "))],8,Hs),h.value?(o(),n("span",Js," Last updated: "+a(f(h.value)),1)):c("",!0)])):c("",!0)]))}}),Xs=A(Ks,[["__scopeId","data-v-096a31fb"]]);export{Xs as default};
